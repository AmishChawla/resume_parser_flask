{% extends 'base.html' %}
{% block title %}Chat{% endblock %}
{% block content %}
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
    background-color: #f8f9fa;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
  .chat-container {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    border-radius: 0;
    overflow: hidden;

    }
  .chat-header {
      background-color: #007bff;
      color: #fff;
      padding: 10px;
      font-size: 18px;
    }
  .chat-body {
      padding: 10px;
      height: 70vh;
      width:100%;

      overflow-y: scroll;
      font-size: 14px;
    }
  .message {
      margin-bottom: 10px;
    }
  .message-bot {
      background-color: #e9ecef;
      border-radius: 10px;
      padding: 5px 10px;
      font-size: 14px;
    }
  .message-user {
      background-color: #254657;
      color: #fff;
      border-radius: 10px;
      padding: 5px 10px;
      text-align: right;
      font-size: 14px;
    }
  .input-container {
      padding: 10px;
      background-color: #f8f9fa;
      border-top: 1px solid #ccc;
      display: flex;
      align-items: center;
    }
  .input-container input[type="text"] {
      flex-grow: 1;
      border-radius: 10px;
      padding: 10px;
      border: none;
      outline: none;
      font-size: 14px;
    }
.final-button {
    border: none;
    outline: none;
    background-color: royalblue;
    padding: 8px 25px; /* Increased padding */
    border-radius: 10px;
    color: #fff;
    font-size: 18px; /* Optional: Adjust font size if needed */
    transform: .3s ease;
    text-decoration: none;
    display: block; /* Make it a block element to apply margin auto */
    margin: auto; /* Center the button horizontally */
    width: fit-content; /* Adjust width to fit content */
    margin-top: 20px; /* Optional: Adjust vertical positioning */
    margin-bottom: 20px; /* Optional: Adjust vertical spacing below the button */
    margin-left:10px;
}

.final-button:hover {
  background-color: rgb(56, 90, 194);
}
    @media (max-width: 768px) {
    .chat-container {
        max-width: 100%;
      }
    .chat-header,.chat-body,.message-bot,.message-user,.input-container input[type="text"],.input-container button {
        font-size: 12px;
      }
    }
</style>
</head>
<body>
 <div class="page-header">
     <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">Chat</h1>
          </div><!-- /.col --><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
 </div>
                <div class="row">
                    <div class="col-lg-12">

 <div style="display: flex; justify-content: space-between;">


<div class="container">
     <div class="chat-container">

      <div class="chat-body" id="chat-body">
        <div class="message message-bot">
          Hello! How can I assist you today?
        </div>
      </div>
      <div class="input-container">
        <input type="text" id="user-input" placeholder="Type your message...">
        <button onclick="sendMessage()" class="final-button">Send</button>
      </div>
         </div>
</div>
                              </div>

                  </div>
      </div>

  <script>
function sendMessage() {
  var userInput = document.getElementById("user-input").value;
  if (userInput.trim() === "") return;
  var chatBody = document.getElementById("chat-body");
  var userMessageDiv = document.createElement("div");
  userMessageDiv.classList.add("message", "message-user");
  userMessageDiv.innerText = userInput;
  chatBody.appendChild(userMessageDiv);
  // Send user input to server using AJAX
  fetch('/send_message', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: 'user_input=' + userInput
  })
 .then(response => response.json())
 .then(data => {
    // Convert Markdown to HTML using marked
    var botMessageDiv = document.createElement("div");
    botMessageDiv.classList.add("message", "message-bot");
    botMessageDiv.innerHTML = data.bot_response.replace(/\n/g, '<br>'); // Convert Markdown to HTML
    chatBody.appendChild(botMessageDiv);
    chatBody.scrollTop = chatBody.scrollHeight;
  });
  document.getElementById("user-input").value = "";
  chatBody.scrollTop = chatBody.scrollHeight;
}

     document.getElementById("user-input").addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        event.preventDefault(); // Prevent form submission if this is inside a form
        sendMessage();
      }
    });
  </script>

{% endblock %}

